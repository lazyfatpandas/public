
def get_sys_stats():
  global max_ram_usage
  max_ram_usage = 0.0
  max_ram = 0.0
  max_cpu = 0.0
  while (1 < 2):
     ram_usage = (psutil.virtual_memory()[3] / 1000000)
     if (max_ram_usage < ram_usage):
        max_ram_usage = ram_usage
     sleep(0.2)

def myfunc():
  start = time()
  SO_c_d_t = {"col0":"float32","col1":"float32","col2":"float32","col3":"float32","col4":"float32","col5":"float32","col6":"float32","col7":"float32","col8":"float32","col9":"float32","col10":"float32","col11":"float32","col12":"float32","col13":"float32","col14":"float32","col15":"float32","col16":"float32","col17":"float32","col18":"float32","col19":"float32","col20":"float32","col21":"float32","col22":"float32","col23":"float32","col24":"float32","col25":"float32","col26":"float32","col27":"float32","col28":"float32","col29":"float32","col30":"float32","col31":"float32","col32":"float32","col33":"float32","col34":"float32","col35":"float32","col36":"float32","col37":"float32","col38":"float32","col39":"float32","col40":"float32","col41":"float32","col42":"float32","col43":"float32","col44":"float32","col45":"float32","col46":"float32","col47":"float32","col48":"float32","col49":"float32","col50":"float32","col51":"float32","col52":"float32","col53":"float32","col54":"float32","col55":"float32","col56":"float32","col57":"float32","col58":"float32","col59":"float32","col60":"float32","col61":"float32","col62":"float32","col63":"float32","col64":"float32","col65":"float32","col66":"float32","col67":"float32","col68":"float32","col69":"float32","col70":"float32","col71":"float32","col72":"float32","col73":"float32","col74":"float32","col75":"float32","col76":"float32","col77":"float32","col78":"float32","col79":"float32","col80":"float32","col81":"float32","col82":"float32","col83":"float32","col84":"float32","col85":"float32","col86":"float32","col87":"float32","col88":"float32","col89":"float32","col90":"float32","col91":"float32","col92":"float32","col93":"float32","col94":"float32","col95":"float32","col96":"float32","col97":"float32","col98":"float32","col99":"float32","col100":"float32","col101":"float32","col102":"float32","col103":"float32","col104":"float32","col105":"float32","col106":"float32","col107":"float32","col108":"float32","col109":"float32","col110":"float32","col111":"float32","col112":"float32","col113":"float32","col114":"float32","col115":"float32","col116":"float32","col117":"float32","col118":"float32","col119":"float32","col120":"float32","col121":"float32","col122":"float32","col123":"float32","col124":"float32","col125":"float32","col126":"float32","col127":"float32","col128":"float32","col129":"float32","col130":"float32","col131":"float32","col132":"float32","col133":"float32","col134":"float32","col135":"float32","col136":"float32","col137":"float32","col138":"float32","col139":"float32","col140":"float32","col141":"float32","col142":"float32","col143":"float32","col144":"float32","col145":"float32","col146":"float32","col147":"float32","col148":"float32","col149":"float32","col150":"float32","col151":"float32","col152":"float32","col153":"float32","col154":"float32","col155":"float32","col156":"float32","col157":"float32","col158":"float32","col159":"float32","col160":"float32","col161":"float32","col162":"float32","col163":"float32","col164":"float32","col165":"float32","col166":"float32","col167":"float32","col168":"float32","col169":"float32","col170":"float32","col171":"float32","col172":"float32","col173":"float32","col174":"float32","col175":"float32","col176":"float32","col177":"float32","col178":"float32","col179":"float32","col180":"float32","col181":"float32","col182":"float32","col183":"float32","col184":"float32","col185":"float32","col186":"float32","col187":"float32","col188":"float32","col189":"float32","col190":"float32","col191":"float32","col192":"float32","col193":"float32","col194":"float32","col195":"float32","col196":"float32","col197":"float32","col198":"float32","col199":"float32","col200":"float32","col201":"float32","col202":"float32","col203":"float32","col204":"float32","col205":"float32","col206":"float32","col207":"float32","col208":"float32","col209":"float32","col210":"float32","col211":"float32","col212":"float32","col213":"float32","col214":"float32","col215":"float32","col216":"float32","col217":"float32","col218":"float32","col219":"float32","col220":"float32","col221":"float32","col222":"float32","col223":"float32","col224":"float32","col225":"float32","col226":"float32","col227":"float32","col228":"float32","col229":"float32","col230":"float32","col231":"float32","col232":"float32","col233":"float32","col234":"float32","col235":"float32","col236":"float32","col237":"float32","col238":"float32","col239":"float32","col240":"float32","col241":"float32","col242":"float32","col243":"float32","col244":"float32","col245":"float32","col246":"float32","col247":"float32","col248":"float32","col249":"float32","col250":"float32","col251":"float32","col252":"float32","col253":"float32","col254":"float32","col255":"float32","col256":"float32","col257":"float32","col258":"float32","col259":"float32","col260":"float32","col261":"float32","col262":"float32","col263":"float32","col264":"float32","col265":"float32","col266":"float32","col267":"float32","col268":"float32","col269":"float32","col270":"float32","col271":"float32","col272":"float32","col273":"float32","col274":"float32","col275":"float32","col276":"float32","col277":"float32","col278":"float32","col279":"float32","col280":"float32","col281":"float32","col282":"float32","col283":"float32","col284":"float32","col285":"float32","col286":"float32","col287":"float32","col288":"float32","col289":"float32","col290":"float32","col291":"float32","col292":"float32","col293":"float32","col294":"float32","col295":"float32","col296":"float32","col297":"float32","col298":"float32","col299":"float32","col300":"float32","col301":"float32","col302":"float32","col303":"float32","col304":"float32","col305":"float32","col306":"float32","col307":"float32","col308":"float32","col309":"float32","col310":"float32","col311":"float32","col312":"float32","col313":"float32","col314":"float32","col315":"float32","col316":"float32","col317":"float32","col318":"float32","col319":"float32","col320":"float32","col321":"float32","col322":"float32","col323":"float32","col324":"float32","col325":"float32","col326":"float32","col327":"float32","col328":"float32","col329":"float32","col330":"float32","col331":"float32","col332":"float32","col333":"float32","col334":"float32","col335":"float32","col336":"float32","col337":"float32","col338":"float32","col339":"float32","col340":"float32","col341":"float32","col342":"float32","col343":"float32","col344":"float32","col345":"float32","col346":"float32","col347":"float32","col348":"float32","col349":"float32","col350":"float32","col351":"float32","col352":"float32","col353":"float32","col354":"float32","col355":"float32","col356":"float32","col357":"float32","col358":"float32","col359":"float32","col360":"float32","col361":"float32","col362":"float32","col363":"float32","col364":"float32","col365":"float32","col366":"float32","col367":"float32","col368":"float32","col369":"float32","col370":"float32","col371":"float32","col372":"float32","col373":"float32","col374":"float32","col375":"float32","col376":"float32","col377":"float32","col378":"float32","col379":"float32","col380":"float32","col381":"float32","col382":"float32","col383":"float32","col384":"float32","col385":"float32","col386":"float32","col387":"float32","col388":"float32","col389":"float32","col390":"float32","col391":"float32","col392":"float32","col393":"float32","col394":"float32","col395":"float32","col396":"float32","col397":"float32","col398":"float32","col399":"float32","col400":"float32","col401":"float32","col402":"float32","col403":"float32","col404":"float32","col405":"float32","col406":"float32","col407":"float32","col408":"float32","col409":"float32","col410":"float32","col411":"float32","col412":"float32","col413":"float32","col414":"float32","col415":"float32","col416":"float32","col417":"float32","col418":"float32","col419":"float32","col420":"float32","col421":"float32","col422":"float32","col423":"float32","col424":"float32","col425":"float32","col426":"float32","col427":"float32","col428":"float32","col429":"float32","col430":"float32","col431":"float32","col432":"float32","col433":"float32","col434":"float32","col435":"float32","col436":"float32","col437":"float32","col438":"float32","col439":"float32","col440":"float32","col441":"float32","col442":"float32","col443":"float32","col444":"float32","col445":"float32","col446":"float32","col447":"float32","col448":"float32","col449":"float32","col450":"float32","col451":"float32","col452":"float32","col453":"float32","col454":"float32","col455":"float32","col456":"float32","col457":"float32","col458":"float32","col459":"float32","col460":"float32","col461":"float32","col462":"float32","col463":"float32","col464":"float32","col465":"float32","col466":"float32","col467":"float32","col468":"float32","col469":"float32","col470":"float32","col471":"float32","col472":"float32","col473":"float32","col474":"float32","col475":"float32","col476":"float32","col477":"float32","col478":"float32","col479":"float32","col480":"float32","col481":"float32","col482":"float32","col483":"float32","col484":"float32","col485":"float32","col486":"float32","col487":"float32","col488":"float32","col489":"float32","col490":"float32","col491":"float32","col492":"float32","col493":"float32","col494":"float32","col495":"float32","col496":"float32","col497":"float32","col498":"float32","col499":"float32","col500":"float32","col501":"float32","col502":"float32","col503":"float32","col504":"float32","col505":"float32","col506":"float32","col507":"float32","col508":"float32","col509":"float32","col510":"float32","col511":"float32","col512":"float32","col513":"float32","col514":"float32","col515":"float32","col516":"float32","col517":"float32","col518":"float32","col519":"float32","col520":"float32","col521":"float32","col522":"float32","col523":"float32","col524":"float32","col525":"float32","col526":"float32","col527":"float32","col528":"float32","col529":"float32","col530":"float32","col531":"float32","col532":"float32","col533":"float32","col534":"float32","col535":"float32","col536":"float32","col537":"float32","col538":"float32","col539":"float32","col540":"float32","col541":"float32","col542":"float32","col543":"float32","col544":"float32","col545":"float32","col546":"float32","col547":"float32","col548":"float32","col549":"float32","col550":"float32","col551":"float32","col552":"float32","col553":"float32","col554":"float32","col555":"float32","col556":"float32","col557":"float32","col558":"float32","col559":"float32","col560":"float32","col561":"float32","col562":"float32","col563":"float32","col564":"float32","col565":"float32","col566":"float32","col567":"float32","col568":"float32","col569":"float32","col570":"float32","col571":"float32","col572":"float32","col573":"float32","col574":"float32","col575":"float32","col576":"float32","col577":"float32","col578":"float32","col579":"float32","col580":"float32","col581":"float32","col582":"float32","col583":"float32","col584":"float32","col585":"float32","col586":"float32","col587":"float32","col588":"float32","col589":"float32","col590":"float32","col591":"float32","col592":"float32","col593":"float32","col594":"float32","col595":"float32","col596":"float32","col597":"float32","col598":"float32","col599":"float32","col600":"float32","col601":"float32","col602":"float32","col603":"float32","col604":"float32","col605":"float32","col606":"float32","col607":"float32","col608":"float32","col609":"float32","col610":"float32","col611":"float32","col612":"float32","col613":"float32","col614":"float32","col615":"float32","col616":"float32","col617":"float32","col618":"float32","col619":"float32","col620":"float32","col621":"float32","col622":"float32","col623":"float32","col624":"float32","col625":"float32","col626":"float32","col627":"float32","col628":"float32","col629":"float32","col630":"float32","col631":"float32","col632":"float32","col633":"float32","col634":"float32","col635":"float32","col636":"float32","col637":"float32","col638":"float32","col639":"float32","col640":"float32","col641":"float32","col642":"float32","col643":"float32","col644":"float32","col645":"float32","col646":"float32","col647":"float32","col648":"float32","col649":"float32","col650":"float32","col651":"float32","col652":"float32","col653":"float32","col654":"float32","col655":"float32","col656":"float32","col657":"float32","col658":"float32","col659":"float32","col660":"float32","col661":"float32","col662":"float32","col663":"float32","col664":"float32","col665":"float32","col666":"float32","col667":"float32","col668":"float32","col669":"float32","col670":"float32","col671":"float32","col672":"float32","col673":"float32","col674":"float32","col675":"float32","col676":"float32","col677":"float32","col678":"float32","col679":"float32","col680":"float32","col681":"float32","col682":"float32","col683":"float32","col684":"float32","col685":"float32","col686":"float32","col687":"float32","col688":"float32","col689":"float32","col690":"float32","col691":"float32","col692":"float32","col693":"float32","col694":"float32","col695":"float32","col696":"float32","col697":"float32","col698":"float32","col699":"float32","col700":"float32","col701":"float32","col702":"float32","col703":"float32","col704":"float32","col705":"float32","col706":"float32","col707":"float32","col708":"float32","col709":"float32","col710":"float32","col711":"float32","col712":"float32","col713":"float32","col714":"float32","col715":"float32","col716":"float32","col717":"float32","col718":"float32","col719":"float32","col720":"float32","col721":"float32","col722":"float32","col723":"float32","col724":"float32","col725":"float32","col726":"float32","col727":"float32","col728":"float32","col729":"float32","col730":"float32","col731":"float32","col732":"float32","col733":"float32","col734":"float32","col735":"float32","col736":"float32","col737":"float32","col738":"float32","col739":"float32","col740":"float32","col741":"float32","col742":"float32","col743":"float32","col744":"float32","col745":"float32","col746":"float32","col747":"float32","col748":"float32","col749":"float32","col750":"float32","col751":"float32","col752":"float32","col753":"float32","col754":"float32","col755":"float32","col756":"float32","col757":"float32","col758":"float32","col759":"float32","col760":"float32","col761":"float32","col762":"float32","col763":"float32","col764":"float32","col765":"float32","col766":"float32","col767":"float32","col768":"float32","col769":"float32","col770":"float32","col771":"float32","col772":"float32","col773":"float32","col774":"float32","col775":"float32","col776":"float32","col777":"float32","col778":"float32","col779":"float32","col780":"float32","col781":"float32","col782":"float32","col783":"float32","col784":"float32","col785":"float32","col786":"float32","col787":"float32","col788":"float32","col789":"float32","col790":"float32","col791":"float32","col792":"float32","col793":"float32","col794":"float32","col795":"float32","col796":"float32","col797":"float32","col798":"float32","col799":"float32","col800":"float32","col801":"float32","col802":"float32","col803":"float32","col804":"float32","col805":"float32","col806":"float32","col807":"float32","col808":"float32","col809":"float32","col810":"float32","col811":"float32","col812":"float32","col813":"float32","col814":"float32","col815":"float32","col816":"float32","col817":"float32","col818":"float32","col819":"float32","col820":"float32","col821":"float32","col822":"float32","col823":"float32","col824":"float32","col825":"float32","col826":"float32","col827":"float32","col828":"float32","col829":"float32","col830":"float32","col831":"float32","col832":"float32","col833":"float32","col834":"float32","col835":"float32","col836":"float32","col837":"float32","col838":"float32","col839":"float32","col840":"float32","col841":"float32","col842":"float32","col843":"float32","col844":"float32","col845":"float32","col846":"float32","col847":"float32","col848":"float32","col849":"float32","col850":"float32","col851":"float32","col852":"float32","col853":"float32","col854":"float32","col855":"float32","col856":"float32","col857":"float32","col858":"float32","col859":"float32","col860":"float32","col861":"float32","col862":"float32","col863":"float32","col864":"float32","col865":"float32","col866":"float32","col867":"float32","col868":"float32","col869":"float32","col870":"float32","col871":"float32","col872":"float32","col873":"float32","col874":"float32","col875":"float32","col876":"float32","col877":"float32","col878":"float32","col879":"float32","col880":"float32","col881":"float32","col882":"float32","col883":"float32","col884":"float32","col885":"float32","col886":"float32","col887":"float32","col888":"float32","col889":"float32","col890":"float32","col891":"float32","col892":"float32","col893":"float32","col894":"float32","col895":"float32","col896":"float32","col897":"float32","col898":"float32","col899":"float32","col900":"float32","col901":"float32","col902":"float32","col903":"float32","col904":"float32","col905":"float32","col906":"float32","col907":"float32","col908":"float32","col909":"float32","col910":"float32","col911":"float32","col912":"float32","col913":"float32","col914":"float32","col915":"float32","col916":"float32","col917":"float32","col918":"float32","col919":"float32","col920":"float32","col921":"float32","col922":"float32","col923":"float32","col924":"float32","col925":"float32","col926":"float32","col927":"float32","col928":"float32","col929":"float32","col930":"float32","col931":"float32","col932":"float32","col933":"float32","col934":"float32","col935":"float32","col936":"float32","col937":"float32","col938":"float32","col939":"float32","col940":"float32","col941":"float32","col942":"float32","col943":"float32","col944":"float32","col945":"float32","col946":"float32","col947":"float32","col948":"float32","col949":"float32","col950":"float32","col951":"float32","col952":"float32","col953":"float32","col954":"float32","col955":"float32","col956":"float32","col957":"float32","col958":"float32","col959":"float32","col960":"float32","col961":"float32","col962":"float32","col963":"float32","col964":"float32","col965":"float32","col966":"float32","col967":"float32","col968":"float32","col969":"float32","col970":"float32","col971":"float32","col972":"float32","col973":"float32","col974":"float32","col975":"float32","col976":"float32","col977":"float32","col978":"float32","col979":"float32","col980":"float32","col981":"float32","col982":"float32","col983":"float32","col984":"float32","col985":"float32","col986":"float32","col987":"float32","col988":"float32","col989":"float32","col990":"float32","col991":"float32","col992":"float32","col993":"float32","col994":"float32","col995":"float32","col996":"float32","col997":"float32","col998":"float32","col999":"float32"}
  df = pd.read_csv('/media/bhushan/nvme1/data/vldb/b3/s2.csv',dtype=SO_c_d_t)
  df['col1_binary'] = (df.col1 > df.col1.quantile(0.1))
  df['col2_binary'] = (df.col1 > 3)
  print(df.head())
  df = df[(df.col2 > 10)]
  print(df.head())
  group_res = df.groupby(['col1_binary']).agg({'col3':['mean']})
  print(group_res.head())
  pd.flush()
  print((time() - start))

import lazyfatpandas.pandas as pd
from time import time
from os import environ
import csv
import os
from tqdm import tqdm
from time import sleep
import psutil
import threading
from threading import *
print = pd.lazyPrint
if (__name__ == '__main__'):
   max_ram_usage = 0.0
   pd.BACKEND_ENGINE = pd.BackendEngines.IBIS
   time1 = time()
   init_ram = (psutil.virtual_memory()[3] / 1000000)
   t1 = threading.Thread(target=get_sys_stats,daemon=True)
   t1.start()
   t2 = threading.Thread(target=myfunc)
   t2.start()
   t2.join()
   ram_usage = (max_ram_usage - init_ram)
   print('Maximum memory used: {} MiB'.format(ram_usage))
   time2 = (time() - time1)
   file = open('../../Results.csv','a',newline='')
   writer = csv.writer(file)
   writer.writerow(['b6','450MB','s2.csv','libis',time2,format(ram_usage),'62a'])
   file.close()
